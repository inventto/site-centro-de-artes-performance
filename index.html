<!DOCTYPE html>
<html>
    <head>
        <title>Performance</title>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="favicon.ico" />
        <link href="stylesheets/application.css" rel="stylesheet" type="text/css" />
        <script src="javascripts/jquery.min.js" type="text/javascript"></script>
        <script src="javascripts/jquery.timeago.js" type="text/javascript"></script>

        <script type="text/javascript">
            $(document).ready(function(){
                $(".menu").load("_menu.html");
            });

            var flickrUser = '93365702@N06', flickrKey = '326464b090f1fac8f2280140544a1d22';
            $.getJSON("http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getList&user_id=" + flickrUser + "&api_key=" + flickrKey + "&jsoncallback=?", function(flickrData){
                 var element = $('#index-albuns');
                 element.append('<div id="flickr_sets"></div>');
                 var length = flickrData.photosets.total;
                 var sets = $("#flickr_sets");
                 for (i=0; i<length; i++) {
                    photoset = flickrData.photosets.photoset[i];
                    args = "flickrSet=" + photoset.id;
                    sets.append("<div id='album_" + photoset.id + "'><a href='fotos.html?last=true&" + args + "' title='" + photoset.description._content + "'>" + photoset.title._content + " </a></div>");
                    loadFlickrSet(photoset.id, i > 0);
                 }
                 $("abbr.timeago").timeago();
            });
            loadFlickrSet = function(flickrSet, adjustMargin){
                $.getJSON("http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getPhotos&photoset_id=" + flickrSet + "&extras=date_upload&api_key=" + flickrKey + "&jsoncallback=?", function(flickrData){
                        element = $('#flickr_sets');
                        last_photo = flickrData.photoset.photo.length - 1;
    					var thumbURL = 'http://farm' + flickrData.photoset.photo[last_photo].farm + '.' + 'static.flickr.com/' + flickrData.photoset.photo[last_photo].server + '/' + flickrData.photoset.photo[last_photo].id + '_' + flickrData.photoset.photo[last_photo].secret + '_s.jpg'
                        time_ago = jQuery.timeago(new Date(flickrData.photoset.photo[last_photo].dateupload * 1000));

                        var margin = adjustMargin ? '24px 10px -24px' : '0px 10px -24px';
                        var thumbHTML = '<img src=' + thumbURL + ' width="75" height="75" title="' + flickrData.photoset.photo[last_photo].title + '" style="margin: ' + margin + '">';
                        $("#album_" + flickrSet).prepend(thumbHTML);
                        $("#album_" + flickrSet).append(' <span class="time-ago">(' + time_ago + ')</span>');
                });
            }

            $.getJSON("https://www.google.com/calendar/feeds/performancefb%40hotmail.com/private-9a607467878beac5e27bfa591212c1c1/full?alt=json-in-script&callback=?&orderby=starttime&max-results=5&singleevents=true&sortorder=ascending&futureevents=true",
                      function(agenda){
                        if (agenda.feed.entry == undefined) {
                          $("#index-agenda").html("");
                          return;
                        }
                        var length = agenda.feed.entry.length;
                        for (i = 0; i < length; i++) {
                          var data = agenda.feed.entry[i].gd$when[0];
                          var startTime = data.startTime.replace(/T.*/,"").split("-").reverse().join("/");
                          var endTime = data.endTime.replace(/T.*/,"").split("-").reverse().join("/");
                          var title = agenda.feed.entry[i].title.$t;
                          var periodo = startTime
                          var color = "#000";
                          if (title.search(/prova/i) >= 0) {
                            color = "#ff0080";
                          }
                          if (title.search(/(in.cio|final|f.rias|volta)/i) >= 0) {
                            color = "red";
                          }
                          if (startTime == endTime) {
                            $('#index-agenda').append("<p style='color:"+color+"'>" + startTime + " - <strong>" + title + "</strong></p>");
                          } else if (startTime.split("/")[1] == endTime.split("/")[1] && startTime.split("/")[2] == endTime.split("/")[2]) {
                            $('#index-agenda').append("<p style='color:"+color+"'>" + startTime.split("/")[0] + " a " + endTime + " - <strong>" + title + "</strong></p>");
                          } else {
                            $('#index-agenda').append("<p style='color:"+color+"'>" + startTime + " a " + endTime + " - <strong>" + title + "</strong></p>");
                          }

                        }
                      });
            $.getJSON("https://www.google.com/calendar/feeds/3sv3aefg65slkecmgb1omfirc8%40group.calendar.google.com/private-a1159206bcc1fae12b66e2f602484b96/full?alt=json-in-script&callback=?&orderby=updated&max-results=5&singleevents=true&sortorder=ascending&futureevents=true",
                      function(agenda){
                        if (agenda.feed.entry == undefined) {
                          $("#index-alunos").html("");
                          return;
                        }
                        length = agenda.feed.entry.length;
                        for (i = 0; i < length; i++) {
                          where = agenda.feed.entry[i].gd$where[0].valueString;
                          if (where != ""){
                            where = "<strong>Local:</strong> " + where;
                          }
                          data = agenda.feed.entry[i].gd$when[0];
                          content = agenda.feed.entry[i].content.$t;
                          title = agenda.feed.entry[i].title.$t;
                          startTime = data.startTime.replace(/T.*/,"").split("-").reverse().join("/");
                          endTime = data.endTime.replace(/T.*/,"").split("-").reverse().join("/");
                          color = "#000";
                          if (startTime == endTime) {
                            $('#index-alunos').append("<p style='color:" + color + "'>" + startTime + " - <strong>" + title + "</strong></p>" + content + "<p>"+where+"</p><hr/>");
                          } else if (startTime.split("/")[1] == endTime.split("/")[1] && startTime.split("/")[2] == endTime.split("/")[2]) {
                            $('#index-alunos').append("<p style='color:" + color + "'>" + startTime.split("/")[0] + " a " + endTime + " - <strong>" + title + "</strong></p>" + content + "<p>" + where +"</p><hr/>");
                          } else {
                            $('#index-alunos').append("<p style='color:" + color + "'>" + startTime + " a " + endTime + " - <strong>" + title + "</strong></p>" + content + "<p>" + where + "</p><hr/>");
                          }
                        }
                      });
        </script>
    </head>
    <body>
        <div id="top_wrapper">
            <div id="top">
                <div id="logo">
                    <a href="index.html"><img src="images/logo.png" title="Centro de Artes Performance"/></a>
                </div>
                <div class="menu">
                </div>
            </div>
        </div>
        <div id="container">
            <div id="index-albuns"><h2>Últimas fotos:</h2></div>
            <div id="index-agenda"><h2>Agenda:</h2></div>
            <i></i>
            <div id="index-alunos"><h2>Área do Aluno:</h2></div>
             <iframe src="https://www.google.com/calendar/embed?showPrint=0&amp;showTz=0&amp;mode=WEEK&amp;height=600&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=4ninva7nrt38rgdjrge6jhide4%40group.calendar.google.com&amp;color=%2323164E&amp;src=9re3frtad5s54se6vvc7d5qh3g%40group.calendar.google.com&amp;color=%232952A3&amp;src=ac1c88ki1njm8pflpg5bn74dao%40group.calendar.google.com&amp;color=%23B1365F&amp;src=8pfmju9jcff92d8a7lsnsdpiqs%40group.calendar.google.com&amp;color=%230D7813&amp;src=laroo29tbe1vpansv7qt5rgego%40group.calendar.google.com&amp;color=%23333333&amp;src=pt2f51qcajnfbvfco9inbmg6jk%40group.calendar.google.com&amp;color=%23A32929&amp;src=3sv3aefg65slkecmgb1omfirc8%40group.calendar.google.com&amp;color=%235229A3&amp;ctz=America%2FSao_Paulo" style=" border-width:0 " width="800" height="600" frameborder="0" scrolling="no"></iframe>
            <i></i>
        </div>
        <div id="footer">
            <div class="menu">
            </div>
        </div>
    </body>
</html>
