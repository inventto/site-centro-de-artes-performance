<!DOCTYPE html>
<html>
    <head>
        <title>Performance</title>
        <meta charset="utf-8">
        <link href="stylesheets/application.css" rel="stylesheet" type="text/css" />
        <script src="javascripts/jquery.min.js" type="text/javascript"></script>
        <script src="javascripts/jquery.timeago.js" type="text/javascript"></script>

        <script type="text/javascript">
            $(document).ready(function(){
                $(".menu").load("_menu.html");
            });

            var flickrUser = '93365702@N06', flickrKey = '326464b090f1fac8f2280140544a1d22';
            $.getJSON("http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getList&user_id=" + flickrUser + "&api_key=" + flickrKey + "&jsoncallback=?", function(flickrData){
                 var element = $('#albuns');
                 element.append('<div id="flickr_sets"></div>');
                 var length = flickrData.photosets.total;
                 var sets = $("#flickr_sets");
                 for (i=0; i<length; i++) {
                    photoset = flickrData.photosets.photoset[i];
                    args = "flickrSet=" + photoset.id;
                    sets.append("<div id='album_" + photoset.id + "'><a href='fotos.html?last=true&" + args + "' title='" + photoset.description._content + "'>" + photoset.title._content + " </a></div>");
                    loadFlickrSet(photoset.id, i > 0);
                 }
                 $("abbr.timeago").timeago();
            });
            loadFlickrSet = function(flickrSet, adjustMargin){
                $.getJSON("http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getPhotos&photoset_id=" + flickrSet + "&extras=date_upload&api_key=" + flickrKey + "&jsoncallback=?", function(flickrData){
                        element = $('#flickr_sets');
                        last_photo = flickrData.photoset.photo.length - 1;
    					var thumbURL = 'http://farm' + flickrData.photoset.photo[last_photo].farm + '.' + 'static.flickr.com/' + flickrData.photoset.photo[last_photo].server + '/' + flickrData.photoset.photo[last_photo].id + '_' + flickrData.photoset.photo[last_photo].secret + '_s.jpg'
                        time_ago = jQuery.timeago(new Date(flickrData.photoset.photo[last_photo].dateupload * 1000));

                        var margin = adjustMargin ? '24px 10px -24px' : '0px 10px -24px';
                        var thumbHTML = '<img src=' + thumbURL + ' width="75" height="75" title="' + flickrData.photoset.photo[last_photo].title + '" style="margin: ' + margin + '">';
                        $("#album_" + flickrSet).prepend(thumbHTML);
                        $("#album_" + flickrSet).append(' <span class="time-ago">(' + time_ago + ')</span>');
                });
            }
            $.getJSON("http://www.google.com/calendar/feeds/performancefb@hotmail.com/public/full?alt=json-in-script&callback=?&orderby=starttime&max-results=5&singleevents=true&sortorder=ascending&futureevents=true",
                      function(agenda){
                        var length = agenda.feed.entry.length;
                        for (i = 0; i < length; i++) {
                          var data = agenda.feed.entry[i].gd$when[0];
                          var startTime = data.startTime.replace(/T.*/,"").split("-").reverse().join("/");
                          var endTime = data.endTime.replace(/T.*/,"").split("-").reverse().join("/");
                          var title = agenda.feed.entry[i].title.$t;
                          var periodo = startTime
                          var color = "#000";
                          if (title.search(/prova/i) >= 0) {
                            color = "#ff0080";
                          }
                          if (title.search(/(in.cio|final|f.rias|volta)/i) >= 0) {
                            color = "red";
                          }
                          if (startTime == endTime) {
                            $('#agenda').append("<p style='color:"+color+"'>" + startTime + " - <strong>" + title + "</strong></p>");
                          } else if (startTime.split("/")[1] == endTime.split("/")[1] && startTime.split("/")[2] == endTime.split("/")[2]) {
                            $('#agenda').append("<p style='color:"+color+"'>" + startTime.split("/")[0] + " a " + endTime + " - <strong>" + title + "</strong></p>");
                          } else {
                            $('#agenda').append("<p style='color:"+color+"'>" + startTime + " a " + endTime + " - <strong>" + title + "</strong></p>");
                          }

                        }
                      });
        </script>
    </head>
    <body>
        <div id="top_wrapper">
            <div id="top">
                <div id="logo">
                    <a href="index.html"><img src="images/logo.png" title="Centro de Artes Performance"/></a>
                </div>
                <div class="menu">
                </div>
            </div>
        </div>
        <div id="container">
            <div id="albuns"><h2>Últimas atualizações dos álbuns:</h2></div>
            <div id="agenda"><h2>Próximos eventos da agenda:</h2></div>
        </div>
        <div id="footer">
            <div class="menu">
            </div>
        </div>
    </body>
</html>
